####################################
# rsyslog Server Configuration
# Central Syslog Server for RHEL8
# Receives logs via UDP and TCP
# Stores logs per client in separate files
####################################

# Load modules for UDP and TCP reception
module(load="imudp")
module(load="imtcp")

# Enable UDP reception on port 514
input(type="imudp" port="514")

# Enable TCP reception on port 514
input(type="imtcp" port="514")

# Template for filenames: separate directory per client
template(name="RemoteHostLogs" type="string" string="/var/log/remote-hosts/%HOSTNAME%/syslog.log")

# Template for log format (optional - with timestamp and additional info)
template(name="DetailedFormat" type="string" string="%TIMESTAMP:::date-rfc3339% %HOSTNAME% %syslogtag%%msg:::sp-if-no-1st-sp%%msg:::drop-last-lf%\n")

# Rule: Write all remote logs to separate files per host
# Filters out local logs (only remote logs)
if $fromhost-ip != '127.0.0.1' then {
    action(type="omfile" dynaFile="RemoteHostLogs" template="DetailedFormat")
    # Stop further processing for remote logs (optional)
    stop
}

# Local logs are still processed normally (standard RHEL8 rules)
